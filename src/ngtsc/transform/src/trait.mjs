/**
 * @license
 * Copyright Google LLC All Rights Reserved.
 *
 * Use of this source code is governed by an MIT-style license that can be
 * found in the LICENSE file at https://angular.io/license
 */
export var TraitState;
(function (TraitState) {
    /**
     * Pending traits are freshly created and have never been analyzed.
     */
    TraitState[TraitState["Pending"] = 0] = "Pending";
    /**
     * Analyzed traits have successfully been analyzed, but are pending resolution.
     */
    TraitState[TraitState["Analyzed"] = 1] = "Analyzed";
    /**
     * Resolved traits have successfully been analyzed and resolved and are ready for compilation.
     */
    TraitState[TraitState["Resolved"] = 2] = "Resolved";
    /**
     * Skipped traits are no longer considered for compilation.
     */
    TraitState[TraitState["Skipped"] = 3] = "Skipped";
})(TraitState || (TraitState = {}));
/**
 * The value side of `Trait` exposes a helper to create a `Trait` in a pending state (by delegating
 * to `TraitImpl`).
 */
export const Trait = {
    pending: (handler, detected) => TraitImpl.pending(handler, detected),
};
/**
 * An implementation of the `Trait` type which transitions safely between the various
 * `TraitState`s.
 */
class TraitImpl {
    constructor(handler, detected) {
        this.state = TraitState.Pending;
        this.analysis = null;
        this.symbol = null;
        this.resolution = null;
        this.analysisDiagnostics = null;
        this.resolveDiagnostics = null;
        this.handler = handler;
        this.detected = detected;
    }
    toAnalyzed(analysis, diagnostics, symbol) {
        // Only pending traits can be analyzed.
        this.assertTransitionLegal(TraitState.Pending, TraitState.Analyzed);
        this.analysis = analysis;
        this.analysisDiagnostics = diagnostics;
        this.symbol = symbol;
        this.state = TraitState.Analyzed;
        return this;
    }
    toResolved(resolution, diagnostics) {
        // Only analyzed traits can be resolved.
        this.assertTransitionLegal(TraitState.Analyzed, TraitState.Resolved);
        if (this.analysis === null) {
            throw new Error(`Cannot transition an Analyzed trait with a null analysis to Resolved`);
        }
        this.resolution = resolution;
        this.state = TraitState.Resolved;
        this.resolveDiagnostics = diagnostics;
        return this;
    }
    toSkipped() {
        // Only pending traits can be skipped.
        this.assertTransitionLegal(TraitState.Pending, TraitState.Skipped);
        this.state = TraitState.Skipped;
        return this;
    }
    /**
     * Verifies that the trait is currently in one of the `allowedState`s.
     *
     * If correctly used, the `Trait` type and transition methods prevent illegal transitions from
     * occurring. However, if a reference to the `TraitImpl` instance typed with the previous
     * interface is retained after calling one of its transition methods, it will allow for illegal
     * transitions to take place. Hence, this assertion provides a little extra runtime protection.
     */
    assertTransitionLegal(allowedState, transitionTo) {
        if (!(this.state === allowedState)) {
            throw new Error(`Assertion failure: cannot transition from ${TraitState[this.state]} to ${TraitState[transitionTo]}.`);
        }
    }
    /**
     * Construct a new `TraitImpl` in the pending state.
     */
    static pending(handler, detected) {
        return new TraitImpl(handler, detected);
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidHJhaXQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi8uLi8uLi8uLi9wYWNrYWdlcy9jb21waWxlci1jbGkvc3JjL25ndHNjL3RyYW5zZm9ybS9zcmMvdHJhaXQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7Ozs7OztHQU1HO0FBTUgsTUFBTSxDQUFOLElBQVksVUFvQlg7QUFwQkQsV0FBWSxVQUFVO0lBQ3BCOztPQUVHO0lBQ0gsaURBQU8sQ0FBQTtJQUVQOztPQUVHO0lBQ0gsbURBQVEsQ0FBQTtJQUVSOztPQUVHO0lBQ0gsbURBQVEsQ0FBQTtJQUVSOztPQUVHO0lBQ0gsaURBQU8sQ0FBQTtBQUNULENBQUMsRUFwQlcsVUFBVSxLQUFWLFVBQVUsUUFvQnJCO0FBa0JEOzs7R0FHRztBQUNILE1BQU0sQ0FBQyxNQUFNLEtBQUssR0FBRztJQUNuQixPQUFPLEVBQUUsQ0FDTCxPQUFxQyxFQUFFLFFBQXlCLEVBQTRCLEVBQUUsQ0FDOUYsU0FBUyxDQUFDLE9BQU8sQ0FBQyxPQUFPLEVBQUUsUUFBUSxDQUFDO0NBQ3pDLENBQUM7QUE2SEY7OztHQUdHO0FBQ0gsTUFBTSxTQUFTO0lBVWIsWUFBWSxPQUFxQyxFQUFFLFFBQXlCO1FBVDVFLFVBQUssR0FBZSxVQUFVLENBQUMsT0FBTyxDQUFDO1FBR3ZDLGFBQVEsR0FBcUIsSUFBSSxDQUFDO1FBQ2xDLFdBQU0sR0FBVyxJQUFJLENBQUM7UUFDdEIsZUFBVSxHQUFxQixJQUFJLENBQUM7UUFDcEMsd0JBQW1CLEdBQXlCLElBQUksQ0FBQztRQUNqRCx1QkFBa0IsR0FBeUIsSUFBSSxDQUFDO1FBRzlDLElBQUksQ0FBQyxPQUFPLEdBQUcsT0FBTyxDQUFDO1FBQ3ZCLElBQUksQ0FBQyxRQUFRLEdBQUcsUUFBUSxDQUFDO0lBQzNCLENBQUM7SUFFRCxVQUFVLENBQUMsUUFBZ0IsRUFBRSxXQUFpQyxFQUFFLE1BQVM7UUFFdkUsdUNBQXVDO1FBQ3ZDLElBQUksQ0FBQyxxQkFBcUIsQ0FBQyxVQUFVLENBQUMsT0FBTyxFQUFFLFVBQVUsQ0FBQyxRQUFRLENBQUMsQ0FBQztRQUNwRSxJQUFJLENBQUMsUUFBUSxHQUFHLFFBQVEsQ0FBQztRQUN6QixJQUFJLENBQUMsbUJBQW1CLEdBQUcsV0FBVyxDQUFDO1FBQ3ZDLElBQUksQ0FBQyxNQUFNLEdBQUcsTUFBTSxDQUFDO1FBQ3JCLElBQUksQ0FBQyxLQUFLLEdBQUcsVUFBVSxDQUFDLFFBQVEsQ0FBQztRQUNqQyxPQUFPLElBQWlDLENBQUM7SUFDM0MsQ0FBQztJQUVELFVBQVUsQ0FBQyxVQUFrQixFQUFFLFdBQWlDO1FBQzlELHdDQUF3QztRQUN4QyxJQUFJLENBQUMscUJBQXFCLENBQUMsVUFBVSxDQUFDLFFBQVEsRUFBRSxVQUFVLENBQUMsUUFBUSxDQUFDLENBQUM7UUFDckUsSUFBSSxJQUFJLENBQUMsUUFBUSxLQUFLLElBQUksRUFBRTtZQUMxQixNQUFNLElBQUksS0FBSyxDQUFDLHNFQUFzRSxDQUFDLENBQUM7U0FDekY7UUFDRCxJQUFJLENBQUMsVUFBVSxHQUFHLFVBQVUsQ0FBQztRQUM3QixJQUFJLENBQUMsS0FBSyxHQUFHLFVBQVUsQ0FBQyxRQUFRLENBQUM7UUFDakMsSUFBSSxDQUFDLGtCQUFrQixHQUFHLFdBQVcsQ0FBQztRQUN0QyxPQUFPLElBQWlDLENBQUM7SUFDM0MsQ0FBQztJQUVELFNBQVM7UUFDUCxzQ0FBc0M7UUFDdEMsSUFBSSxDQUFDLHFCQUFxQixDQUFDLFVBQVUsQ0FBQyxPQUFPLEVBQUUsVUFBVSxDQUFDLE9BQU8sQ0FBQyxDQUFDO1FBQ25FLElBQUksQ0FBQyxLQUFLLEdBQUcsVUFBVSxDQUFDLE9BQU8sQ0FBQztRQUNoQyxPQUFPLElBQWdDLENBQUM7SUFDMUMsQ0FBQztJQUVEOzs7Ozs7O09BT0c7SUFDSyxxQkFBcUIsQ0FBQyxZQUF3QixFQUFFLFlBQXdCO1FBQzlFLElBQUksQ0FBQyxDQUFDLElBQUksQ0FBQyxLQUFLLEtBQUssWUFBWSxDQUFDLEVBQUU7WUFDbEMsTUFBTSxJQUFJLEtBQUssQ0FBQyw2Q0FBNkMsVUFBVSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsT0FDL0UsVUFBVSxDQUFDLFlBQVksQ0FBQyxHQUFHLENBQUMsQ0FBQztTQUNsQztJQUNILENBQUM7SUFFRDs7T0FFRztJQUNILE1BQU0sQ0FBQyxPQUFPLENBQ1YsT0FBcUMsRUFBRSxRQUF5QjtRQUNsRSxPQUFPLElBQUksU0FBUyxDQUFDLE9BQU8sRUFBRSxRQUFRLENBQTZCLENBQUM7SUFDdEUsQ0FBQztDQUNGIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBAbGljZW5zZVxuICogQ29weXJpZ2h0IEdvb2dsZSBMTEMgQWxsIFJpZ2h0cyBSZXNlcnZlZC5cbiAqXG4gKiBVc2Ugb2YgdGhpcyBzb3VyY2UgY29kZSBpcyBnb3Zlcm5lZCBieSBhbiBNSVQtc3R5bGUgbGljZW5zZSB0aGF0IGNhbiBiZVxuICogZm91bmQgaW4gdGhlIExJQ0VOU0UgZmlsZSBhdCBodHRwczovL2FuZ3VsYXIuaW8vbGljZW5zZVxuICovXG5cbmltcG9ydCAqIGFzIHRzIGZyb20gJ3R5cGVzY3JpcHQnO1xuaW1wb3J0IHtTZW1hbnRpY1N5bWJvbH0gZnJvbSAnLi4vLi4vaW5jcmVtZW50YWwvc2VtYW50aWNfZ3JhcGgnO1xuaW1wb3J0IHtEZWNvcmF0b3JIYW5kbGVyLCBEZXRlY3RSZXN1bHR9IGZyb20gJy4vYXBpJztcblxuZXhwb3J0IGVudW0gVHJhaXRTdGF0ZSB7XG4gIC8qKlxuICAgKiBQZW5kaW5nIHRyYWl0cyBhcmUgZnJlc2hseSBjcmVhdGVkIGFuZCBoYXZlIG5ldmVyIGJlZW4gYW5hbHl6ZWQuXG4gICAqL1xuICBQZW5kaW5nLFxuXG4gIC8qKlxuICAgKiBBbmFseXplZCB0cmFpdHMgaGF2ZSBzdWNjZXNzZnVsbHkgYmVlbiBhbmFseXplZCwgYnV0IGFyZSBwZW5kaW5nIHJlc29sdXRpb24uXG4gICAqL1xuICBBbmFseXplZCxcblxuICAvKipcbiAgICogUmVzb2x2ZWQgdHJhaXRzIGhhdmUgc3VjY2Vzc2Z1bGx5IGJlZW4gYW5hbHl6ZWQgYW5kIHJlc29sdmVkIGFuZCBhcmUgcmVhZHkgZm9yIGNvbXBpbGF0aW9uLlxuICAgKi9cbiAgUmVzb2x2ZWQsXG5cbiAgLyoqXG4gICAqIFNraXBwZWQgdHJhaXRzIGFyZSBubyBsb25nZXIgY29uc2lkZXJlZCBmb3IgY29tcGlsYXRpb24uXG4gICAqL1xuICBTa2lwcGVkLFxufVxuXG4vKipcbiAqIEFuIEl2eSBhc3BlY3QgYWRkZWQgdG8gYSBjbGFzcyAoZm9yIGV4YW1wbGUsIHRoZSBjb21waWxhdGlvbiBvZiBhIGNvbXBvbmVudCBkZWZpbml0aW9uKS5cbiAqXG4gKiBUcmFpdHMgYXJlIGNyZWF0ZWQgd2hlbiBhIGBEZWNvcmF0b3JIYW5kbGVyYCBtYXRjaGVzIGEgY2xhc3MuIEVhY2ggdHJhaXQgYmVnaW5zIGluIGEgcGVuZGluZ1xuICogc3RhdGUgYW5kIHVuZGVyZ29lcyB0cmFuc2l0aW9ucyBhcyBjb21waWxhdGlvbiBwcm9jZWVkcyB0aHJvdWdoIHRoZSB2YXJpb3VzIHN0ZXBzLlxuICpcbiAqIEluIHByYWN0aWNlLCB0cmFpdHMgYXJlIGluc3RhbmNlcyBvZiB0aGUgcHJpdmF0ZSBjbGFzcyBgVHJhaXRJbXBsYCBkZWNsYXJlZCBiZWxvdy4gVGhyb3VnaCB0aGVcbiAqIHZhcmlvdXMgaW50ZXJmYWNlcyBpbmNsdWRlZCBpbiB0aGlzIHVuaW9uIHR5cGUsIHRoZSBsZWdhbCBBUEkgb2YgYSB0cmFpdCBpbiBhbnkgZ2l2ZW4gc3RhdGUgaXNcbiAqIHJlcHJlc2VudGVkIGluIHRoZSB0eXBlIHN5c3RlbS4gVGhpcyBpbmNsdWRlcyBhbnkgcG9zc2libGUgdHJhbnNpdGlvbnMgZnJvbSBvbmUgdHlwZSB0byB0aGUgbmV4dC5cbiAqXG4gKiBUaGlzIG5vdCBvbmx5IHNpbXBsaWZpZXMgdGhlIGltcGxlbWVudGF0aW9uLCBidXQgZW5zdXJlcyB0cmFpdHMgYXJlIG1vbm9tb3JwaGljIG9iamVjdHMgYXNcbiAqIHRoZXkncmUgYWxsIGp1c3QgXCJ2aWV3c1wiIGluIHRoZSB0eXBlIHN5c3RlbSBvZiB0aGUgc2FtZSBvYmplY3QgKHdoaWNoIG5ldmVyIGNoYW5nZXMgc2hhcGUpLlxuICovXG5leHBvcnQgdHlwZSBUcmFpdDxELCBBLCBTIGV4dGVuZHMgU2VtYW50aWNTeW1ib2x8bnVsbCwgUj4gPSBQZW5kaW5nVHJhaXQ8RCwgQSwgUywgUj58XG4gICAgU2tpcHBlZFRyYWl0PEQsIEEsIFMsIFI+fEFuYWx5emVkVHJhaXQ8RCwgQSwgUywgUj58UmVzb2x2ZWRUcmFpdDxELCBBLCBTLCBSPjtcblxuLyoqXG4gKiBUaGUgdmFsdWUgc2lkZSBvZiBgVHJhaXRgIGV4cG9zZXMgYSBoZWxwZXIgdG8gY3JlYXRlIGEgYFRyYWl0YCBpbiBhIHBlbmRpbmcgc3RhdGUgKGJ5IGRlbGVnYXRpbmdcbiAqIHRvIGBUcmFpdEltcGxgKS5cbiAqL1xuZXhwb3J0IGNvbnN0IFRyYWl0ID0ge1xuICBwZW5kaW5nOiA8RCwgQSwgUyBleHRlbmRzIFNlbWFudGljU3ltYm9sfG51bGwsIFI+KFxuICAgICAgaGFuZGxlcjogRGVjb3JhdG9ySGFuZGxlcjxELCBBLCBTLCBSPiwgZGV0ZWN0ZWQ6IERldGVjdFJlc3VsdDxEPik6IFBlbmRpbmdUcmFpdDxELCBBLCBTLCBSPiA9PlxuICAgICAgVHJhaXRJbXBsLnBlbmRpbmcoaGFuZGxlciwgZGV0ZWN0ZWQpLFxufTtcblxuLyoqXG4gKiBUaGUgcGFydCBvZiB0aGUgYFRyYWl0YCBpbnRlcmZhY2UgdGhhdCdzIGNvbW1vbiB0byBhbGwgdHJhaXQgc3RhdGVzLlxuICovXG5leHBvcnQgaW50ZXJmYWNlIFRyYWl0QmFzZTxELCBBLCBTIGV4dGVuZHMgU2VtYW50aWNTeW1ib2x8bnVsbCwgUj4ge1xuICAvKipcbiAgICogQ3VycmVudCBzdGF0ZSBvZiB0aGUgdHJhaXQuXG4gICAqXG4gICAqIFRoaXMgd2lsbCBiZSBuYXJyb3dlZCBpbiB0aGUgaW50ZXJmYWNlcyBmb3IgZWFjaCBzcGVjaWZpYyBzdGF0ZS5cbiAgICovXG4gIHN0YXRlOiBUcmFpdFN0YXRlO1xuXG4gIC8qKlxuICAgKiBUaGUgYERlY29yYXRvckhhbmRsZXJgIHdoaWNoIG1hdGNoZWQgb24gdGhlIGNsYXNzIHRvIGNyZWF0ZSB0aGlzIHRyYWl0LlxuICAgKi9cbiAgaGFuZGxlcjogRGVjb3JhdG9ySGFuZGxlcjxELCBBLCBTLCBSPjtcblxuICAvKipcbiAgICogVGhlIGRldGVjdGlvbiByZXN1bHQgKG9mIGBoYW5kbGVyLmRldGVjdGApIHdoaWNoIGluZGljYXRlZCB0aGF0IHRoaXMgdHJhaXQgYXBwbGllZCB0byB0aGVcbiAgICogY2xhc3MuXG4gICAqXG4gICAqIFRoaXMgaXMgbWFpbmx5IHVzZWQgdG8gY2FjaGUgdGhlIGRldGVjdGlvbiBiZXR3ZWVuIHByZS1hbmFseXNpcyBhbmQgYW5hbHlzaXMuXG4gICAqL1xuICBkZXRlY3RlZDogRGV0ZWN0UmVzdWx0PEQ+O1xufVxuXG4vKipcbiAqIEEgdHJhaXQgaW4gdGhlIHBlbmRpbmcgc3RhdGUuXG4gKlxuICogUGVuZGluZyB0cmFpdHMgaGF2ZSB5ZXQgdG8gYmUgYW5hbHl6ZWQgaW4gYW55IHdheS5cbiAqL1xuZXhwb3J0IGludGVyZmFjZSBQZW5kaW5nVHJhaXQ8RCwgQSwgUyBleHRlbmRzIFNlbWFudGljU3ltYm9sfG51bGwsIFI+IGV4dGVuZHNcbiAgICBUcmFpdEJhc2U8RCwgQSwgUywgUj4ge1xuICBzdGF0ZTogVHJhaXRTdGF0ZS5QZW5kaW5nO1xuXG4gIC8qKlxuICAgKiBUaGlzIHBlbmRpbmcgdHJhaXQgaGFzIGJlZW4gc3VjY2Vzc2Z1bGx5IGFuYWx5emVkLCBhbmQgc2hvdWxkIHRyYW5zaXRpb24gdG8gdGhlIFwiYW5hbHl6ZWRcIlxuICAgKiBzdGF0ZS5cbiAgICovXG4gIHRvQW5hbHl6ZWQoYW5hbHlzaXM6IEF8bnVsbCwgZGlhZ25vc3RpY3M6IHRzLkRpYWdub3N0aWNbXXxudWxsLCBzeW1ib2w6IFMpOlxuICAgICAgQW5hbHl6ZWRUcmFpdDxELCBBLCBTLCBSPjtcblxuICAvKipcbiAgICogRHVyaW5nIGFuYWx5c2lzIGl0IHdhcyBkZXRlcm1pbmVkIHRoYXQgdGhpcyB0cmFpdCBpcyBub3QgZWxpZ2libGUgZm9yIGNvbXBpbGF0aW9uIGFmdGVyIGFsbCxcbiAgICogYW5kIHNob3VsZCBiZSB0cmFuc2l0aW9uZWQgdG8gdGhlIFwic2tpcHBlZFwiIHN0YXRlLlxuICAgKi9cbiAgdG9Ta2lwcGVkKCk6IFNraXBwZWRUcmFpdDxELCBBLCBTLCBSPjtcbn1cblxuLyoqXG4gKiBBIHRyYWl0IGluIHRoZSBcInNraXBwZWRcIiBzdGF0ZS5cbiAqXG4gKiBTa2lwcGVkIHRyYWl0cyBhcmVuJ3QgY29uc2lkZXJlZCBmb3IgY29tcGlsYXRpb24uXG4gKlxuICogVGhpcyBpcyBhIHRlcm1pbmFsIHN0YXRlLlxuICovXG5leHBvcnQgaW50ZXJmYWNlIFNraXBwZWRUcmFpdDxELCBBLCBTIGV4dGVuZHMgU2VtYW50aWNTeW1ib2x8bnVsbCwgUj4gZXh0ZW5kc1xuICAgIFRyYWl0QmFzZTxELCBBLCBTLCBSPiB7XG4gIHN0YXRlOiBUcmFpdFN0YXRlLlNraXBwZWQ7XG59XG5cbi8qKlxuICogQSB0cmFpdCBpbiB0aGUgXCJhbmFseXplZFwiIHN0YXRlLlxuICpcbiAqIEFuYWx5emVkIHRyYWl0cyBoYXZlIGFuYWx5c2lzIHJlc3VsdHMgYXZhaWxhYmxlLCBhbmQgYXJlIGVsaWdpYmxlIGZvciByZXNvbHV0aW9uLlxuICovXG5leHBvcnQgaW50ZXJmYWNlIEFuYWx5emVkVHJhaXQ8RCwgQSwgUyBleHRlbmRzIFNlbWFudGljU3ltYm9sfG51bGwsIFI+IGV4dGVuZHNcbiAgICBUcmFpdEJhc2U8RCwgQSwgUywgUj4ge1xuICBzdGF0ZTogVHJhaXRTdGF0ZS5BbmFseXplZDtcbiAgc3ltYm9sOiBTO1xuXG4gIC8qKlxuICAgKiBBbmFseXNpcyByZXN1bHRzIG9mIHRoZSBnaXZlbiB0cmFpdCAoaWYgYWJsZSB0byBiZSBwcm9kdWNlZCksIG9yIGBudWxsYCBpZiBhbmFseXNpcyBmYWlsZWRcbiAgICogY29tcGxldGVseS5cbiAgICovXG4gIGFuYWx5c2lzOiBSZWFkb25seTxBPnxudWxsO1xuXG4gIC8qKlxuICAgKiBBbnkgZGlhZ25vc3RpY3MgdGhhdCByZXN1bHRlZCBmcm9tIGFuYWx5c2lzLCBvciBgbnVsbGAgaWYgbm9uZS5cbiAgICovXG4gIGFuYWx5c2lzRGlhZ25vc3RpY3M6IHRzLkRpYWdub3N0aWNbXXxudWxsO1xuXG4gIC8qKlxuICAgKiBUaGlzIGFuYWx5emVkIHRyYWl0IGhhcyBiZWVuIHN1Y2Nlc3NmdWxseSByZXNvbHZlZCwgYW5kIHNob3VsZCBiZSB0cmFuc2l0aW9uZWQgdG8gdGhlXG4gICAqIFwicmVzb2x2ZWRcIiBzdGF0ZS5cbiAgICovXG4gIHRvUmVzb2x2ZWQocmVzb2x1dGlvbjogUnxudWxsLCBkaWFnbm9zdGljczogdHMuRGlhZ25vc3RpY1tdfG51bGwpOiBSZXNvbHZlZFRyYWl0PEQsIEEsIFMsIFI+O1xufVxuXG4vKipcbiAqIEEgdHJhaXQgaW4gdGhlIFwicmVzb2x2ZWRcIiBzdGF0ZS5cbiAqXG4gKiBSZXNvbHZlZCB0cmFpdHMgaGF2ZSBiZWVuIHN1Y2Nlc3NmdWxseSBhbmFseXplZCBhbmQgcmVzb2x2ZWQsIGNvbnRhaW4gbm8gZXJyb3JzLCBhbmQgYXJlIHJlYWR5XG4gKiBmb3IgdGhlIGNvbXBpbGF0aW9uIHBoYXNlLlxuICpcbiAqIFRoaXMgaXMgYSB0ZXJtaW5hbCBzdGF0ZS5cbiAqL1xuZXhwb3J0IGludGVyZmFjZSBSZXNvbHZlZFRyYWl0PEQsIEEsIFMgZXh0ZW5kcyBTZW1hbnRpY1N5bWJvbHxudWxsLCBSPiBleHRlbmRzXG4gICAgVHJhaXRCYXNlPEQsIEEsIFMsIFI+IHtcbiAgc3RhdGU6IFRyYWl0U3RhdGUuUmVzb2x2ZWQ7XG4gIHN5bWJvbDogUztcblxuICAvKipcbiAgICogUmVzb2x2ZWQgdHJhaXRzIG11c3QgaGF2ZSBwcm9kdWNlZCB2YWxpZCBhbmFseXNpcyByZXN1bHRzLlxuICAgKi9cbiAgYW5hbHlzaXM6IFJlYWRvbmx5PEE+O1xuXG4gIC8qKlxuICAgKiBBbmFseXNpcyBtYXkgaGF2ZSBzdGlsbCByZXN1bHRlZCBpbiBkaWFnbm9zdGljcy5cbiAgICovXG4gIGFuYWx5c2lzRGlhZ25vc3RpY3M6IHRzLkRpYWdub3N0aWNbXXxudWxsO1xuXG4gIC8qKlxuICAgKiBEaWFnbm9zdGljcyByZXN1bHRpbmcgZnJvbSByZXNvbHV0aW9uIGFyZSB0cmFja2VkIHNlcGFyYXRlbHkgZnJvbVxuICAgKi9cbiAgcmVzb2x2ZURpYWdub3N0aWNzOiB0cy5EaWFnbm9zdGljW118bnVsbDtcblxuICAvKipcbiAgICogVGhlIHJlc3VsdHMgcmV0dXJuZWQgYnkgYSBzdWNjZXNzZnVsIHJlc29sdXRpb24gb2YgdGhlIGdpdmVuIGNsYXNzL2BEZWNvcmF0b3JIYW5kbGVyYFxuICAgKiBjb21iaW5hdGlvbi5cbiAgICovXG4gIHJlc29sdXRpb246IFJlYWRvbmx5PFI+fG51bGw7XG59XG5cbi8qKlxuICogQW4gaW1wbGVtZW50YXRpb24gb2YgdGhlIGBUcmFpdGAgdHlwZSB3aGljaCB0cmFuc2l0aW9ucyBzYWZlbHkgYmV0d2VlbiB0aGUgdmFyaW91c1xuICogYFRyYWl0U3RhdGVgcy5cbiAqL1xuY2xhc3MgVHJhaXRJbXBsPEQsIEEsIFMgZXh0ZW5kcyBTZW1hbnRpY1N5bWJvbHxudWxsLCBSPiB7XG4gIHN0YXRlOiBUcmFpdFN0YXRlID0gVHJhaXRTdGF0ZS5QZW5kaW5nO1xuICBoYW5kbGVyOiBEZWNvcmF0b3JIYW5kbGVyPEQsIEEsIFMsIFI+O1xuICBkZXRlY3RlZDogRGV0ZWN0UmVzdWx0PEQ+O1xuICBhbmFseXNpczogUmVhZG9ubHk8QT58bnVsbCA9IG51bGw7XG4gIHN5bWJvbDogU3xudWxsID0gbnVsbDtcbiAgcmVzb2x1dGlvbjogUmVhZG9ubHk8Uj58bnVsbCA9IG51bGw7XG4gIGFuYWx5c2lzRGlhZ25vc3RpY3M6IHRzLkRpYWdub3N0aWNbXXxudWxsID0gbnVsbDtcbiAgcmVzb2x2ZURpYWdub3N0aWNzOiB0cy5EaWFnbm9zdGljW118bnVsbCA9IG51bGw7XG5cbiAgY29uc3RydWN0b3IoaGFuZGxlcjogRGVjb3JhdG9ySGFuZGxlcjxELCBBLCBTLCBSPiwgZGV0ZWN0ZWQ6IERldGVjdFJlc3VsdDxEPikge1xuICAgIHRoaXMuaGFuZGxlciA9IGhhbmRsZXI7XG4gICAgdGhpcy5kZXRlY3RlZCA9IGRldGVjdGVkO1xuICB9XG5cbiAgdG9BbmFseXplZChhbmFseXNpczogQXxudWxsLCBkaWFnbm9zdGljczogdHMuRGlhZ25vc3RpY1tdfG51bGwsIHN5bWJvbDogUyk6XG4gICAgICBBbmFseXplZFRyYWl0PEQsIEEsIFMsIFI+IHtcbiAgICAvLyBPbmx5IHBlbmRpbmcgdHJhaXRzIGNhbiBiZSBhbmFseXplZC5cbiAgICB0aGlzLmFzc2VydFRyYW5zaXRpb25MZWdhbChUcmFpdFN0YXRlLlBlbmRpbmcsIFRyYWl0U3RhdGUuQW5hbHl6ZWQpO1xuICAgIHRoaXMuYW5hbHlzaXMgPSBhbmFseXNpcztcbiAgICB0aGlzLmFuYWx5c2lzRGlhZ25vc3RpY3MgPSBkaWFnbm9zdGljcztcbiAgICB0aGlzLnN5bWJvbCA9IHN5bWJvbDtcbiAgICB0aGlzLnN0YXRlID0gVHJhaXRTdGF0ZS5BbmFseXplZDtcbiAgICByZXR1cm4gdGhpcyBhcyBBbmFseXplZFRyYWl0PEQsIEEsIFMsIFI+O1xuICB9XG5cbiAgdG9SZXNvbHZlZChyZXNvbHV0aW9uOiBSfG51bGwsIGRpYWdub3N0aWNzOiB0cy5EaWFnbm9zdGljW118bnVsbCk6IFJlc29sdmVkVHJhaXQ8RCwgQSwgUywgUj4ge1xuICAgIC8vIE9ubHkgYW5hbHl6ZWQgdHJhaXRzIGNhbiBiZSByZXNvbHZlZC5cbiAgICB0aGlzLmFzc2VydFRyYW5zaXRpb25MZWdhbChUcmFpdFN0YXRlLkFuYWx5emVkLCBUcmFpdFN0YXRlLlJlc29sdmVkKTtcbiAgICBpZiAodGhpcy5hbmFseXNpcyA9PT0gbnVsbCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKGBDYW5ub3QgdHJhbnNpdGlvbiBhbiBBbmFseXplZCB0cmFpdCB3aXRoIGEgbnVsbCBhbmFseXNpcyB0byBSZXNvbHZlZGApO1xuICAgIH1cbiAgICB0aGlzLnJlc29sdXRpb24gPSByZXNvbHV0aW9uO1xuICAgIHRoaXMuc3RhdGUgPSBUcmFpdFN0YXRlLlJlc29sdmVkO1xuICAgIHRoaXMucmVzb2x2ZURpYWdub3N0aWNzID0gZGlhZ25vc3RpY3M7XG4gICAgcmV0dXJuIHRoaXMgYXMgUmVzb2x2ZWRUcmFpdDxELCBBLCBTLCBSPjtcbiAgfVxuXG4gIHRvU2tpcHBlZCgpOiBTa2lwcGVkVHJhaXQ8RCwgQSwgUywgUj4ge1xuICAgIC8vIE9ubHkgcGVuZGluZyB0cmFpdHMgY2FuIGJlIHNraXBwZWQuXG4gICAgdGhpcy5hc3NlcnRUcmFuc2l0aW9uTGVnYWwoVHJhaXRTdGF0ZS5QZW5kaW5nLCBUcmFpdFN0YXRlLlNraXBwZWQpO1xuICAgIHRoaXMuc3RhdGUgPSBUcmFpdFN0YXRlLlNraXBwZWQ7XG4gICAgcmV0dXJuIHRoaXMgYXMgU2tpcHBlZFRyYWl0PEQsIEEsIFMsIFI+O1xuICB9XG5cbiAgLyoqXG4gICAqIFZlcmlmaWVzIHRoYXQgdGhlIHRyYWl0IGlzIGN1cnJlbnRseSBpbiBvbmUgb2YgdGhlIGBhbGxvd2VkU3RhdGVgcy5cbiAgICpcbiAgICogSWYgY29ycmVjdGx5IHVzZWQsIHRoZSBgVHJhaXRgIHR5cGUgYW5kIHRyYW5zaXRpb24gbWV0aG9kcyBwcmV2ZW50IGlsbGVnYWwgdHJhbnNpdGlvbnMgZnJvbVxuICAgKiBvY2N1cnJpbmcuIEhvd2V2ZXIsIGlmIGEgcmVmZXJlbmNlIHRvIHRoZSBgVHJhaXRJbXBsYCBpbnN0YW5jZSB0eXBlZCB3aXRoIHRoZSBwcmV2aW91c1xuICAgKiBpbnRlcmZhY2UgaXMgcmV0YWluZWQgYWZ0ZXIgY2FsbGluZyBvbmUgb2YgaXRzIHRyYW5zaXRpb24gbWV0aG9kcywgaXQgd2lsbCBhbGxvdyBmb3IgaWxsZWdhbFxuICAgKiB0cmFuc2l0aW9ucyB0byB0YWtlIHBsYWNlLiBIZW5jZSwgdGhpcyBhc3NlcnRpb24gcHJvdmlkZXMgYSBsaXR0bGUgZXh0cmEgcnVudGltZSBwcm90ZWN0aW9uLlxuICAgKi9cbiAgcHJpdmF0ZSBhc3NlcnRUcmFuc2l0aW9uTGVnYWwoYWxsb3dlZFN0YXRlOiBUcmFpdFN0YXRlLCB0cmFuc2l0aW9uVG86IFRyYWl0U3RhdGUpOiB2b2lkIHtcbiAgICBpZiAoISh0aGlzLnN0YXRlID09PSBhbGxvd2VkU3RhdGUpKSB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYEFzc2VydGlvbiBmYWlsdXJlOiBjYW5ub3QgdHJhbnNpdGlvbiBmcm9tICR7VHJhaXRTdGF0ZVt0aGlzLnN0YXRlXX0gdG8gJHtcbiAgICAgICAgICBUcmFpdFN0YXRlW3RyYW5zaXRpb25Ub119LmApO1xuICAgIH1cbiAgfVxuXG4gIC8qKlxuICAgKiBDb25zdHJ1Y3QgYSBuZXcgYFRyYWl0SW1wbGAgaW4gdGhlIHBlbmRpbmcgc3RhdGUuXG4gICAqL1xuICBzdGF0aWMgcGVuZGluZzxELCBBLCBTIGV4dGVuZHMgU2VtYW50aWNTeW1ib2x8bnVsbCwgUj4oXG4gICAgICBoYW5kbGVyOiBEZWNvcmF0b3JIYW5kbGVyPEQsIEEsIFMsIFI+LCBkZXRlY3RlZDogRGV0ZWN0UmVzdWx0PEQ+KTogUGVuZGluZ1RyYWl0PEQsIEEsIFMsIFI+IHtcbiAgICByZXR1cm4gbmV3IFRyYWl0SW1wbChoYW5kbGVyLCBkZXRlY3RlZCkgYXMgUGVuZGluZ1RyYWl0PEQsIEEsIFMsIFI+O1xuICB9XG59XG4iXX0=